<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>胡大仙 | 胡大仙</title><meta name="author" content="huxianseng"><meta name="copyright" content="huxianseng"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="自我介绍 面试官，您好！我叫胡平生。我做个简短的自我介绍吧！我目前就读于上海电力大学的硕士研究生，专业是大数据技术与工程。本科就读于安徽理工大学的物联网工程。本硕都是计算机类专业，而且本硕期间都获得了奖学金，目前已经通过英语6级考试。【在学有余力的情况下，还考取了软件设计师中级的软考证书】。去年年末，在上海的平安科技（金融公司）从事开发工程师的实习工作。当时是用Java做的后端项目开发。所以说，有">
<meta property="og:type" content="article">
<meta property="og:title" content="胡大仙">
<meta property="og:url" content="http://hupingsheng.com/%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95%E9%A2%98/index.html">
<meta property="og:site_name" content="胡大仙">
<meta property="og:description" content="自我介绍 面试官，您好！我叫胡平生。我做个简短的自我介绍吧！我目前就读于上海电力大学的硕士研究生，专业是大数据技术与工程。本科就读于安徽理工大学的物联网工程。本硕都是计算机类专业，而且本硕期间都获得了奖学金，目前已经通过英语6级考试。【在学有余力的情况下，还考取了软件设计师中级的软考证书】。去年年末，在上海的平安科技（金融公司）从事开发工程师的实习工作。当时是用Java做的后端项目开发。所以说，有">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://hupingsheng.com/images/home.webp">
<meta property="article:published_time" content="2023-10-11T11:10:53.711Z">
<meta property="article:modified_time" content="2023-10-24T07:44:36.368Z">
<meta property="article:author" content="huxianseng">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://hupingsheng.com/images/home.webp"><link rel="shortcut icon" href="/images/my_logo.png"><link rel="canonical" href="http://hupingsheng.com/%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95%E9%A2%98/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '胡大仙',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-10-24 15:44:36'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/images/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">53</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">19</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/images/home.webp')"><nav id="nav"><span id="blog-info"><a href="/" title="胡大仙"><span class="site-name">胡大仙</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">无题</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-10-11T11:10:53.711Z" title="发表于 2023-10-11 19:10:53">2023-10-11</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-10-24T07:44:36.368Z" title="更新于 2023-10-24 15:44:36">2023-10-24</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">11k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>37分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h3 id="自我介绍">自我介绍</h3>
<p>面试官，您好！我叫胡平生。我做个简短的自我介绍吧！我目前就读于上海电力大学的硕士研究生，专业是大数据技术与工程。本科就读于安徽理工大学的物联网工程。本硕都是计算机类专业，而且本硕期间都获得了奖学金，目前已经通过英语6级考试。【在学有余力的情况下，还考取了软件设计师中级的软考证书】。去年年末，在上海的平安科技（金融公司）从事开发工程师的实习工作。当时是用Java做的后端项目开发。所以说，有一定的项目开发经历。 本硕期间除了学校教授的计算机理论知识，比如数据结构，计算机网络，操作系统，数据库等等理论知识。还利用了课外时间学习了 Spring这种目前主流的开发框架 。现在想应聘xxx公司的xxx岗位，谢谢！【生活中我是一个比较积极乐观的人，一般会通过运动打球的方式来放松。】我一直都非常想加入贵公司，我觉得贵公司的文化和技术氛围我都非常喜欢，期待能与你共事！</p>
<h2 id="项目">项目</h2>
<h3 id="互动游戏社区">互动游戏社区</h3>
<h4 id="最近做的一个项目？">最近做的一个项目？</h4>
<p>最近做的一个项目就是游戏社区项目了</p>
<p>它是基于SpringBoot构建的对抗游戏社区系统，支持多名玩家同时在线匹配真人对抗；同时增添社区属性，比如战力排行榜、关注、评论，点赞，签到打卡等社区功能，为游戏体验增添了互动的元素。</p>
<h4 id="这个项目遇到什么难点？">这个项目遇到什么难点？</h4>
<p>什么背景（技术问题）</p>
<p>过程（解决问题的过程）</p>
<p>最终落地方案</p>
<p>maven声明周期</p>
<p>clean   default(complie test package)</p>
<h4 id="这个项目WebSocket怎么用的？">这个项目WebSocket怎么用的？</h4>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Yee-Q/p/14823171.html">SpringBoot + WebSocket 实现答题对战匹配机制 - 低吟不作语 - 博客园 (cnblogs.com)</a></p>
<ul>
<li><code>服务拆分</code>：匹配一般是热点服务 所以我们设计这个匹配系统的时候，把它单拎出去，便于扩展，提高系统的瓶颈。</li>
<li><code>WebSocket</code> : 匹配是一个要求高频率低延时的业务场景，所以我们需要用到长连接 (WebSocket) 来实现客户端与服务端的通信，并把连接维护起来。</li>
<li>使用的是<code>Spring-boot-starter-websocket</code>，<code>@ServerEndpoint</code>注解标识在<code>WebSocket</code>类上，里面有</li>
</ul>
<p>onOpen方法，onclose，onMessage方法，sendMessage()方法，其中<code>@OnMessage</code>是客户端发过来的消息，维护一个Session变量，用来给客户端发送消息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(String message)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">      <span class="built_in">this</span>.session.getBasicRemote().sendText(message);</span><br><span class="line">      <span class="comment">//this.session.getAsyncRemote().sendText(message);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="这个项目是怎么用的concurrentHashMap的？">这个项目是怎么用的concurrentHashMap的？</h4>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/liaodong2010/article/details/101487210">SpringBoot + Netty + WebSocket + ConcurrentHashMap 高性能消息推送服务器_netty能同时存在两个concurrenthashmap-CSDN博客</a></p>
<p>这个项目里面有个功能是实现多名玩家项目匹配的嘛，匹配成功，直接返回给客户端嘛。 匹配是一个异步的过程嘛，所以需要用到长连接 (WebSocket) 来实现客户端与服务端的通信，并把连接维护起来！建立连接之后就会把用户和连接维护到 <code>concurrentHashMap</code> 里，来维护连接的状态信息 (用户和连接的绑定)，方便在匹配到两个用户之后，</p>
<p>服务器需要维护<code>&lt;ID, Connection&gt;</code>的对应关系，这样客户端发来消息时可以找到应该推送给谁。那么我们应该用什么样的数据结构呢？</p>
<p><strong>几种方案的选择：</strong></p>
<p>List。可以实现，但是每次查找的时候需要遍历列表，也就是O(n)复杂度。在连接较少的时候还可以接收，如果消息和连接数多了之后，无疑会增大系统开销，降低效率<br>
HashMap。于是我们想到了HashMap，因为HashMap的插入、查找可以O(1)的复杂度。但是HashMap不是线程安全的，put操作会导致元素丢失。<a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903796225605640#heading-3">深入解读HashMap线程安全性问题</a></p>
<p>HashTable。为了实现线程安全，可以使用HashTable。但其内部采用synchronized进行同步，是一种悲观锁，所以在多线程环境下会造成激烈竞争。</p>
<p>ConcurrentHashMap。所以最后选择了并发HashMap。ConcurrentHashMap使用了锁分段技术，将数据分段，读写时对每段加锁，这样就避免了多个线程竞争同一把锁的情况，大大提高了性能。<br>
使用单哈希表有一个缺陷，那就是通过Value查找Key的复杂度是 O(n)，因此以空间换时间的方法，使用两个ConcurrentHashMap构成双向哈希表，实现 O(1)时间的Key-&gt;Value或Value-&gt;Key的 查找、增加、删除。</p>
<h4 id="ConcurrentHashMap怎么做到线程安全的">ConcurrentHashMap怎么做到线程安全的</h4>
<p><img src="/%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95%E9%A2%98/java8_concurrenthashmap.png" alt="Java8 ConcurrentHashMap 存储结构"></p>
<p><strong>线程安全实现方式</strong>：JDK 1.7 采用 <code>Segment</code> 分段锁来保证安全， <code>Segment</code> 是继承自 <code>ReentrantLock</code>。JDK1.8 放弃了 <code>Segment</code> 分段锁的设计，采用 <code>Node + CAS + synchronized</code> 保证线程安全，锁粒度更细，<code>synchronized</code> 只锁定当前链表或红黑二叉树的首节点。</p>
<p><strong>Hash 碰撞解决方法</strong> : JDK 1.7 采用拉链法，JDK1.8 采用拉链法结合红黑树（链表长度超过一定阈值时，将链表转换为红黑树）。</p>
<p><strong>并发度</strong>：JDK 1.7 最大并发度是 Segment 的个数，默认是 16。JDK 1.8 最大并发度是 Node 数组的大小，并发度更大。</p>
<h4 id="这个项目哪里用到多线程的？用什么方式创建线程的">这个项目哪里用到多线程的？用什么方式创建线程的</h4>
<p>后台匹配系统匹配好两个客户端后，就会根据ConcurrentHashMap集合找到userId，然后返回给前端，同时开启另一个游戏线程，等待两名客户端的输入，防止卡壳。</p>
<h4 id="项目为什么用到ReentrantLock的？">项目为什么用到ReentrantLock的？</h4>
<p>这要是对客户端的输入操作进行加锁，保持互斥，这里是将输入存入到一个step变量中，这里就涉及客户端对这个变量的写入，以及游戏线程对这个变量的读取。</p>
<h4 id="项目中有redis，主要存储了哪些信息？">项目中有redis，主要存储了哪些信息？</h4>
<ul>
<li>
<p>采用set类型存储用户点赞</p>
<p>以实体为Key，用户userId为value，一个用户只能对一个实体点赞一次，不能重复，所以set类型很合适</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisKeyUtil</span> &#123;   </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SPLIT</span> <span class="operator">=</span> <span class="string">&quot;:&quot;</span>;    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PREFIX_ENTITY_LIKE</span> <span class="operator">=</span> <span class="string">&quot;like:entity&quot;</span>;  <span class="comment">//点赞的key前缀    </span></span><br><span class="line">    <span class="comment">//某个实体（帖子/评论）的赞    //like:entity:entityType:entityId -&gt; set(userId)    </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getEntityLikeKey</span><span class="params">(<span class="type">int</span> entityType, <span class="type">int</span> entityId)</span> &#123;        </span><br><span class="line">        <span class="keyword">return</span> PREFIX_ENTITY_LIKE + SPLIT + entityType + SPLIT + entityId;    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以判断某一实体是否点赞了<code>isMember</code>，可以记录点赞这个行为<code>add</code>，可以统计某一实体收到的点赞数量<code>size</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">like</span><span class="params">(<span class="type">int</span> userId, <span class="type">int</span> entityType, <span class="type">int</span> entityId)</span> &#123;</span><br><span class="line">       <span class="type">String</span> <span class="variable">entityLikeKey</span> <span class="operator">=</span> RedisKeyUtil.getEntityLikeKey(entityType, entityId);</span><br><span class="line">       <span class="keyword">if</span> (redisTemplate.opsForSet().isMember(entityLikeKey, userId)) &#123;</span><br><span class="line">           redisTemplate.opsForSet().remove(entityLikeKey, userId);</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           redisTemplate.opsForSet().add(entityLikeKey, userId);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>某一用户收到的赞</p>
<p>重构点赞功能</p>
<p>​	采用string类型来记录，某一用户收到的赞，以userId为Key，记录点赞数量。increment(key)，decrement(key)</p>
<blockquote>
<p>一次点赞行为，需要操作对redis的两个key进行操作，涉及redis的事务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  //点赞  A用户 对 B用户的实体（帖子/评论）点赞---&gt;决定需要哪些参数</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">like</span><span class="params">(<span class="type">int</span> userId, <span class="type">int</span> entityType, <span class="type">int</span> entityId, <span class="type">int</span> entityUserId)</span> &#123;</span><br><span class="line">    <span class="comment">//更新某用户的赞，需要保证事务性</span></span><br><span class="line">    redisTemplate.execute(<span class="keyword">new</span> <span class="title class_">SessionCallback</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> Object <span class="title function_">execute</span><span class="params">(RedisOperations operations)</span> <span class="keyword">throws</span> DataAccessException &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">entityLikeKey</span> <span class="operator">=</span> RedisKeyUtil.getEntityLikeKey(entityType, entityId);</span><br><span class="line">            <span class="type">String</span> <span class="variable">userLikeKey</span> <span class="operator">=</span> RedisKeyUtil.getUserLikeKey(entityUserId);</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">isMember</span> <span class="operator">=</span> operations.opsForSet().isMember(entityLikeKey, userId);</span><br><span class="line">            <span class="comment">//开启事务</span></span><br><span class="line">            operations.multi();</span><br><span class="line">            <span class="keyword">if</span> (isMember) &#123;</span><br><span class="line">                operations.opsForSet().remove(entityLikeKey, userId);</span><br><span class="line">                operations.opsForValue().decrement(userLikeKey);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                operations.opsForSet().add(entityLikeKey, userId);</span><br><span class="line">                operations.opsForValue().increment(userLikeKey);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> operations.exec();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>补充关于redis事务的知识</strong>：</p>
</blockquote>
</li>
<li>
<p>关注与被关注（粉丝）也采用了redis来存储的，使用zset数据类型</p>
<p><code>follower:entityType:entityId -&gt; zSet(userId,time)</code>    key:entity  value:userId，score:time</p>
<p><code>followee:userId:entityType -&gt; zSet(entityId,time) </code>    key:userId,entity   value:entityId</p>
<p>关注操作，涉及两个key的操作。user关注的key，entity被关注的key。事务操作。</p>
<p>用两个key的目的：<strong>获取关注数和被关注数的业务都非常方便写</strong>。</p>
</li>
<li>
<p>存放登录的token。redis中的String类型存储登录凭证，代替数据库，提高访问的频率</p>
<p>以生成的随机数为key，value为一个实体string(userId，expireTime)，设置为逻辑过期时间</p>
<p>每次访问拦截器进行登录凭证验证：从数据库中查询凭证改为从redis中查询凭证</p>
</li>
<li>
<p>redis作为缓存，缓存登录的用户信息。</p>
<p>之前每次拦截器验证完token后，都会向数据库查询User实体，然后存入到ThreadLocal中，方便后面随时获取登录用户信息。</p>
<p>现在改成每次拦截器查询时，从redis进行读取。提高效率。</p>
<p>但是缓存也不是无中生有就可以查询的，如何初始化缓存呢？如何更新缓存呢？</p>
<ul>
<li>
<blockquote>
<p>面试题：</p>
<p><strong>什么时候查询缓存以及初始化缓存？</strong></p>
<p>登录后的访问</p>
<p>首先拦截器正常从缓存中查询数据</p>
<ul>
<li>查到就直接存储ThreadLocal</li>
<li>查不到就查询数据库，并初始化缓存，再存储到ThreadLocal</li>
</ul>
<p><strong>什么时候会更新缓存呢？</strong></p>
<p>涉及到修改缓存中对象属性的操作。比如这个项目中，缓存的是用户信息，那么我修改自己的用户名，用户头像，就不能简单的只修改数据库中的User表了，还要修改redis中的对应的user。（当然，这里采取的是删除策略，属于<strong>延迟更新的操作，把更新操作留给查询，避免多次无效更新</strong>，还有并发问题）</p>
<img src="/%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95%E9%A2%98/../项目/论坛项目/Redis一站式高性能存储/image-20230910160002681.png" alt="image-20230910160002681" style="zoom: 67%;">
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//从缓存中取数据</span></span><br><span class="line"><span class="keyword">private</span> User <span class="title function_">getCache</span><span class="params">(<span class="type">int</span> userId)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">redisKey</span> <span class="operator">=</span> RedisKeyUtil.getUserKey(userId);</span><br><span class="line">    <span class="keyword">return</span> (User) redisTemplate.opsForValue().get(redisKey);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//初始化缓存</span></span><br><span class="line"><span class="keyword">private</span> User <span class="title function_">initCache</span><span class="params">(<span class="type">int</span> userId)</span> &#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectById(userId);  <span class="comment">//查询数据库</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">redisKey</span> <span class="operator">=</span> RedisKeyUtil.getUserKey(userId);</span><br><span class="line">    redisTemplate.opsForValue().set(redisKey, user, <span class="number">3600</span>, TimeUnit.SECONDS);</span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//清除缓存</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">clearCache</span><span class="params">(<span class="type">int</span> userId)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">redisKey</span> <span class="operator">=</span> RedisKeyUtil.getUserKey(userId);</span><br><span class="line">    redisTemplate.delete(redisKey);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p><strong>存储热门帖子</strong></p>
<p>定时任务计算帖子分数</p>
</li>
</ul>
<h4 id="项目有用到事务管理？">项目有用到事务管理？</h4>
<p>项目中的关注功能涉及redis的事务管理。</p>
<h4 id="项目定时任务做什么的？使用什么技术的？">项目定时任务做什么的？使用什么技术的？</h4>
<h4 id="既然redis作为缓存了，那么如何保证和数据库的一致性呢？">既然redis作为缓存了，那么如何保证和数据库的一致性呢？</h4>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6964531365643550751">美团二面：Redis与MySQL双写一致性如何保证？ - 掘金 (juejin.cn)</a></p>
<p>对于强一致性业务，可以使用redisson读写锁来保证一致性</p>
<p>对于非强一致性业务，可以使用延时双删，或者先更新数据库再删除缓存</p>
<p>延时双删：如果是写操作，先把缓存中的数据删除，然后更新数据库，最后再延时删除缓存中的数据库，这个延时不好确定，在延时的过程中可能存在脏数据，并不能保证强一致性。</p>
<h4 id="这个项目有用消息中间件？Kafka">这个项目有用消息中间件？Kafka?</h4>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/DCFT_newone/article/details/122252355">RabbitMq+SpringBoot实现站内消息分发_springboot站内信-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/CSDN2497242041/article/details/120359947">【精选】WebSocket+RabbitMQ实现消息推送系统_rabbitmq websocket-CSDN博客</a></p>
<p>系统通知，比如关注，点赞行为会引发站内系统通知。会将这些时间存放在kafka中</p>
<h4 id="项目的评论功能，表的字段如何设计的？">项目的评论功能，表的字段如何设计的？</h4>
<h4 id="redis作为缓存，持久化怎么做到的">redis作为缓存，持久化怎么做到的</h4>
<ol>
<li>RDB</li>
<li>AOF</li>
</ol>
<p><img src="/%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95%E9%A2%98/image-20231012011807282.png" alt="image-20231012011807282"></p>
<p><img src="/%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95%E9%A2%98/image-20231012011843302.png" alt="image-20231012011843302"></p>
<p><img src="/%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95%E9%A2%98/image-20231012011538945.png" alt="image-20231012011538945"></p>
<h4 id="项目怎么使用HyperLogLog-和-BitMap的？">项目怎么使用HyperLogLog 和 BitMap的？</h4>
<p>HyperLogLog：以日期为key   ip为value  来统计UV</p>
<p>BitMap：以日期为key   userId为value   来统计DAU</p>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1516744">巧用 Redis Hyperloglog，轻松统计 UV 数据-腾讯云开发者社区-腾讯云 (tencent.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/315232832">redis灵魂拷问：聊一聊bitmap使用 - 知乎 (zhihu.com)</a></p>
<p>HyperLogLog是一种数据结构自带去重效果，在Redis中只占用12kb，却可以计算2^62个数（相当于10^14个用户）。值得注意的是，他是一估算值，存在一个小于1%的误差。通常我们统计一个页面的UV的时候不需要特别准确的数据，对于老板老来说105w和106w没什么区别。相比于set，既可以做到去重，又可以节省大量内存</p>
<ul>
<li>
<p>UV(Unique Visitor)</p>
<ul>
<li>独立访客，通过IP地址去重统计，希望把匿名用户（游客）也统计起来</li>
<li>每次访问都要统计，因为不确定此次访问的IP是否已经记录过</li>
<li>用<strong>HyperLogLog</strong>进行统计，性能好，且存储空间小。</li>
</ul>
</li>
<li>
<p>DAU（Daily Active User）</p>
<ul>
<li>日活跃用户</li>
<li>访问过一次则认为其是活跃用户。</li>
<li>与UV的区别是：通过<code>userId</code>进行去重（已注册用户），而且是比较<strong>精确</strong>的结果，故使用<strong>bitmap</strong>。可以用userId为Index，在redis中存储，key为日期，所以每天需要大概几十万位。</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PREFIX_UV</span> <span class="operator">=</span> <span class="string">&quot;uv&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PREFIX_DAU</span> <span class="operator">=</span> <span class="string">&quot;DAU&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//单日UV  HyperLogLog</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getUVKey</span><span class="params">(String date)</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> PREFIX_UV + SPLIT + date;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//区间UV</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getUVKey</span><span class="params">(String startDate, String endDate)</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> PREFIX_UV + SPLIT + startDate + SPLIT + endDate;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//单日DAU   BitMap</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getDAUKey</span><span class="params">(String date)</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> PREFIX_DAU + SPLIT + date;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//区间DAU</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getDAUKey</span><span class="params">(String startDate, String endDate)</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> PREFIX_DAU + SPLIT + startDate + SPLIT + endDate;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p><strong>DataService</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">SimpleDateFormat</span> <span class="variable">dateFormat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyyMMdd&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//记录单日UV数据，记录指定IP</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">recordIV</span><span class="params">(String ip)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">redisKey</span> <span class="operator">=</span> RedisKeyUtil.getUVKey(dateFormat.format(<span class="keyword">new</span> <span class="title class_">Date</span>()));</span><br><span class="line">        redisTemplate.opsForHyperLogLog().add(redisKey, ip);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//统计指定范围内的UV</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">calculateUV</span><span class="params">(Date start, Date end)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (end == <span class="literal">null</span> || start == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;参数不能为空&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//整理key</span></span><br><span class="line">        List&lt;String&gt; keyList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">Calendar</span> <span class="variable">calendar</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">        calendar.setTime(start);</span><br><span class="line">        <span class="keyword">while</span> (!calendar.getTime().after(end)) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> RedisKeyUtil.getUVKey(dateFormat.format(calendar.getTime()));</span><br><span class="line">            keyList.add(key);</span><br><span class="line">            calendar.add(Calendar.DATE, <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">redisKey</span> <span class="operator">=</span> RedisKeyUtil.getUVKey(dateFormat.format(start), dateFormat.format(end));</span><br><span class="line">        redisTemplate.opsForHyperLogLog().union(redisKey, keyList.toArray());  <span class="comment">//合并数据，所有数据不重复</span></span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHyperLogLog().size(redisKey);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//记录指定用户到DAU</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">recordDAU</span><span class="params">(<span class="type">int</span> userId)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">redisKey</span> <span class="operator">=</span> RedisKeyUtil.getDAUKey(dateFormat.format(<span class="keyword">new</span> <span class="title class_">Date</span>()));</span><br><span class="line">        redisTemplate.opsForValue().setBit(redisKey, userId, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//统计指定范围内的DAU</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">calculateDAU</span><span class="params">(Date start, Date end)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (end == <span class="literal">null</span> || start == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;参数不能为空&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//整理key</span></span><br><span class="line">        List&lt;<span class="type">byte</span>[]&gt; keyList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">Calendar</span> <span class="variable">calendar</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">        calendar.setTime(start);</span><br><span class="line">        <span class="keyword">while</span> (!calendar.getTime().after(end)) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> RedisKeyUtil.getDAUKey(dateFormat.format(calendar.getTime()));</span><br><span class="line">            keyList.add(key.getBytes());</span><br><span class="line">            calendar.add(Calendar.DATE, <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">redisKey</span> <span class="operator">=</span> RedisKeyUtil.getDAUKey(dateFormat.format(start), dateFormat.format(end));</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">long</span>) redisTemplate.execute(<span class="keyword">new</span> <span class="title class_">RedisCallback</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Object <span class="title function_">doInRedis</span><span class="params">(RedisConnection connection)</span> <span class="keyword">throws</span> DataAccessException &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">redisKey</span> <span class="operator">=</span> RedisKeyUtil.getDAUKey(dateFormat.format(start), dateFormat.format(end));</span><br><span class="line">                connection.bitOp(RedisStringCommands.BitOperation.OR, redisKey.getBytes(), keyList.toArray(<span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">0</span>][<span class="number">0</span>]));</span><br><span class="line">                <span class="keyword">return</span> connection.bitCount(redisKey.getBytes());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="拦截器">拦截器</h3>
<p>每次访问的时候都要拦截且记录ip和userId</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Datainteceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DataService dataService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> HostHolder hostHolder;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> &#123;</span><br><span class="line">        <span class="comment">//记录UV     </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">ip</span> <span class="operator">=</span> request.getRemoteHost();  <span class="comment">//获取Ip地址</span></span><br><span class="line">        dataService.recordIV(ip);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//记录DAU    </span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> hostHolder.getUser();</span><br><span class="line">        <span class="keyword">if</span> (user != <span class="literal">null</span>) &#123;</span><br><span class="line">            dataService.recordDAU(user.getId());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Controller">Controller</h3>
<ul>
<li>访问数据页</li>
<li>查询UV</li>
<li>查询DAU</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DataService dataService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(path = &quot;/data&quot;, method = &#123;RequestMethod.GET, RequestMethod.POST&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDataPage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;/site/admin/data&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(path = &quot;/data/uv&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUV</span><span class="params">(<span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span> Date start,</span></span><br><span class="line"><span class="params">                        <span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span> Date end, Model model)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">uv</span> <span class="operator">=</span> dataService.calculateUV(start, end);</span><br><span class="line">        model.addAttribute(<span class="string">&quot;uvResult&quot;</span>, uv);</span><br><span class="line">        model.addAttribute(<span class="string">&quot;uvStartDate&quot;</span>, start);</span><br><span class="line">        model.addAttribute(<span class="string">&quot;uvEndDate&quot;</span>, end);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;forward:/data&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(path = &quot;/data/dau&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDAU</span><span class="params">(<span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span> Date start,</span></span><br><span class="line"><span class="params">                         <span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span> Date end, Model model)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">uv</span> <span class="operator">=</span> dataService.calculateDAU(start, end);</span><br><span class="line">        model.addAttribute(<span class="string">&quot;dauResult&quot;</span>, uv);</span><br><span class="line">        model.addAttribute(<span class="string">&quot;dauStartDate&quot;</span>, start);</span><br><span class="line">        model.addAttribute(<span class="string">&quot;dauEndDate&quot;</span>, end);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;forward:/data&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="实习项目">实习项目</h3>
<h4 id="介绍一下实习做的事情">介绍一下实习做的事情</h4>
<ol>
<li>
<p>参与&quot;规则引擎风险控制平台&quot;项目的开发和重构，负责部分业务接口的实现。</p>
</li>
<li>
<p>与测试人员进行对接，修复开发过程中出现的缺陷。</p>
</li>
<li>
<p>完成整个项目的单元测试。</p>
</li>
<li>
<p>设计并实现整个项目的登录权限系统。</p>
</li>
</ol>
<h4 id="介绍一下实习的项目">介绍一下实习的项目</h4>
<p>当时做的项目是Radar风险控制系统，它是一个完整复杂事件处理框架，分为<strong>平台管理端</strong>和<strong>大数据计算端</strong></p>
<p>我当时进去就是做的平台的管理系统，就是写一些常见的业务代码，后面做了一些权限控制的功能。</p>
<h4 id="这个项目有哪些权限啊？">这个项目有哪些权限啊？</h4>
<p>这是一个规则引擎系统嘛，所以这个管理后台定义了一下**“事件管理”，“流量管理”，“策略管理”，“策略更新”，“Kafka管理”，“策略发布”**这些管理权限嘛。同时登录用户，我们又分为超管，用户，当是超管登录的话，我们是给他路由所有的管理功能的，普通用户以租户的身份登录的时候，是去除策略发布，kafka管理这些功能的。</p>
<h4 id="介绍一下你是怎么做权限系统的。">介绍一下你是怎么做权限系统的。</h4>
<p>getInfo接口根据当前登录用户id  查询权限并返回给前端，</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 前端请求格式</span></span><br><span class="line"><span class="attr">&quot;permissions&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">			<span class="string">&quot;system:user:list&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;system:role:list&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;system:menu:list&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;system:user:query&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;system:user:add&quot;</span></span><br><span class="line">            <span class="comment">//此次省略1000字</span></span><br><span class="line">		<span class="punctuation">]</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>
<p>前端为了实现动态路由的效果，需要后端有接口<strong>能返回用户所能访问的菜单数据。</strong>(不同级别用户展示的菜单不同—动态展示)-----&gt;实现动态路由。</p>
<p><code>@PreAuthorize</code>会在方法执行前进行权限验证，实现接口的权限控制</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">@PreAuthorize(&quot;@ps.hasPermission(&#x27;content:category:export&#x27;)&quot;)</span><br><span class="line">@GetMapping(&quot;/export&quot;)</span><br><span class="line">    public void export(HttpServletResponse response)&#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            //设置下载文件的请求头</span><br><span class="line">            WebUtils.setDownLoadHeader(&quot;分类.xlsx&quot;,response);</span><br><span class="line">            //获取需要导出的数据</span><br><span class="line">            List&lt;Category&gt; categoryVos = categoryService.list();</span><br><span class="line"></span><br><span class="line">            List&lt;ExcelCategoryVo&gt; excelCategoryVos = BeanCopyUtils.copyBeanList(categoryVos, ExcelCategoryVo.class);</span><br><span class="line">            //把数据写入到Excel中</span><br><span class="line">            EasyExcel.write(response.getOutputStream(), ExcelCategoryVo.class).autoCloseStream(Boolean.FALSE).sheet(&quot;分类导出&quot;)</span><br><span class="line">                    .doWrite(excelCategoryVos);</span><br><span class="line"></span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            //如果出现异常也要响应json</span><br><span class="line">            ResponseResult result = ResponseResult.errorResult(AppHttpCodeEnum.SYSTEM_ERROR);</span><br><span class="line">            WebUtils.renderString(response, JSON.toJSONString(result));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@Service(&quot;ps&quot;)</span><br><span class="line">public class PermissionService &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 判断当前用户是否具有permission</span><br><span class="line">     * @param permission 要判断的权限</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public boolean hasPermission(String permission)&#123;</span><br><span class="line">        //如果是超级管理员  直接返回true</span><br><span class="line">        if(SecurityUtils.isAdmin())&#123;</span><br><span class="line">            return true;</span><br><span class="line">        &#125;</span><br><span class="line">        //否则  获取当前登录用户所具有的权限列表 如何判断是否存在permission</span><br><span class="line">        List&lt;String&gt; permissions = SecurityUtils.getLoginUser().getPermissions();</span><br><span class="line">        return permissions.contains(permission);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="单点登录如何实现的？">单点登录如何实现的？</h4>
<p>单点登录的英文名叫做：Single Sign On（简称<strong>SSO</strong>）,只需要登录一次，就可以访问所有信任的应用系统</p>
<p><img src="/%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95%E9%A2%98/image-20231013131849586.png" alt="image-20231013131849586"></p>
<p>jwt token结合网关判断来完成单点登录</p>
<ul>
<li>
<p>I.用户访问其他系统，会在网关判断token是否有效</p>
</li>
<li>
<p>II.如果token无效则会返回401（认证失败）前端跳转到登录页面</p>
</li>
<li>
<p>III.用户发送登录请求，返回浏览器一个token，浏览器把token保存到cookie</p>
</li>
<li>
<p>IV.再去访问其他服务的时候，都需要携带token，由<strong>网关统一验证后路由到目标服务</strong></p>
</li>
</ul>
<h4 id="权限认证如何实现？">权限认证如何实现？</h4>
<p><strong>采用RBAC模型，基于角色的访问控制</strong></p>
<p>3个基础部分组成：用户、角色、权限</p>
<p>Spring Security</p>
<p><img src="/%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95%E9%A2%98/image-20231014164237843.png" alt="image-20231014164237843"></p>
<h4 id="上传数据的安全性你们怎么控制？（网络传输的安全性）">上传数据的安全性你们怎么控制？（网络传输的安全性）</h4>
<p>使用非对称加密（或对称加密），给前端一个公钥让他把数据加密后传到后台，后台负责解密后处理数据</p>
<ul>
<li>
<p>文件很大建议使用对称加密，不过不能保存敏感信息</p>
</li>
<li>
<p>文件较小，要求安全性高，建议采用非对称加密</p>
</li>
</ul>
<h4 id="项目的日志是怎么采集的？">项目的日志是怎么采集的？</h4>
<p>常规采集：按天保存到一个日志文件</p>
<p><img src="/%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95%E9%A2%98/image-20231014165714820.png" alt="image-20231014165714820"></p>
<h4 id="查看日志的命令">查看日志的命令</h4>
<h3 id="Kafka">Kafka</h3>
<h4 id="Kafka为什么这么快？-高吞吐量">Kafka为什么这么快？(高吞吐量)</h4>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/mikechenshare/p/16709978.html">Kafka为什么性能这么快？4大核心原因详解</a></p>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/2335249">消息队列（3）–Kafka高性能是怎么做到的-腾讯云开发者社区-腾讯云 (tencent.com)</a></p>
<ul>
<li>
<p>磁盘顺序写</p>
</li>
<li>
<p>页缓存</p>
<p>Kafka避免使用JVM，直接使用操作系统的页缓存特性提高处理速度，避免JVM GC带来的性能损耗</p>
</li>
<li>
<p>零拷贝</p>
<p>通过 零拷贝技术，就不需要把 os cache （页缓存）里的数据拷贝到应用缓存，再从应用缓存拷贝到 Socket 缓存了，两次拷贝都省略了，所以叫做零拷贝。</p>
<p><img src="/%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95%E9%A2%98/image-20231011200248661.png" alt="image-20231011200248661"></p>
</li>
<li>
<p>批处理操作</p>
<p>发送拉取消息和Broker服务端存储消息，都是以批为单元进行的，消费者在拉取消息后，在客户端把批消息解开，再一条一条交给用户代码处理。</p>
<p>构建批消息和解开批消息分别在发送端和消费端的客户端完成，不仅减轻了 Broker 的压力，最重要的是减少了 Broker 处理请求的次数，提升了总体的处理能力</p>
</li>
</ul>
<h4 id="项目是如何管理kafka的">项目是如何管理kafka的</h4>
<p>主要是给当前的登陆用户，设置规则，设置主题，设置集群broken这些相关的kafka配置信息</p>
<h4 id="kafka是如何作为一个消息队列模型的">kafka是如何作为一个消息队列模型的</h4>
<p><img src="/%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95%E9%A2%98/fy05ar9akg.png" alt="在这里插入图片描述"></p>
<p>如图所示，Kafka是基于<strong>发布订阅模型</strong>进行消息传输的，在发送接收消息前首先需要为每一个producer和consumer指定topic主题，即关注的消息类型，这样才能进行消息传输，而所有的topic都存储在服务器broker集群上。</p>
<h4 id="Kafka-多副本（Replica）机制有什么好处呢？"><strong>Kafka 多副本（Replica）机制有什么好处呢？</strong></h4>
<ol>
<li>Partition 可以指定对应的 Replica 数, 这也极大地提高了消息存储的安全性, 提高了容灾能力，不过也相应的增加了所需要的存储空间。</li>
</ol>
<h4 id="KafKa的多分区（Partition）机制有什么好处？">KafKa的多分区（Partition）机制有什么好处？</h4>
<p>Kafka 通过给特定 Topic 指定多个 Partition, 而各个 Partition 可以分布在不同的 Broker 上, 这样便能提供比较好的并发能力（负载均衡）。</p>
<p><img src="/%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95%E9%A2%98/image-20231023135127074.png" alt="image-20231023135127074"></p>
<h4 id="如何实现Kafka的顺序消费">如何实现Kafka的顺序消费</h4>
<ol>
<li>
<p>为什么会出现消费顺序不一致</p>
<p>在Kafka中存储消息采取Partition分区机制来实现消息的物理存储，也就是说在同一个topic中维护多个partition来实现消息的分片。生产者在发送消息时，会根据消息的key进行取模运算来决定将当前的消息存储到哪一个Partition，</p>
</li>
<li>
<ul>
<li>
<p>发送消息时指定分区号</p>
</li>
<li>
<p>发送消息时按照相同的业务设置相同的key</p>
</li>
</ul>
<p><img src="/%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95%E9%A2%98/image-20231023134715441.png" alt="image-20231023134715441"></p>
</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6985040577989607454">Kafka 消息队列如何保证顺序性？ - 掘金 (juejin.cn)</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/javastack/p/16026661.html">Kafka 怎么顺序消费？面试必备。。。 - Java技术栈 - 博客园 (cnblogs.com)</a></p>
<h4 id="kafka中zookeeper的作用？">kafka中zookeeper的作用？</h4>
<p><strong>Broker 注册</strong>：在 Zookeeper 上会有一个专门<strong>用来进行 Broker 服务器列表记录</strong>的节点。每个 Broker 在启动时，都会到 Zookeeper 上进行注册，即到 <code>/brokers/ids</code> 下创建属于自己的节点。每个 Broker 就会将自己的 IP 地址和端口等信息记录到该节点中去</p>
<p><strong>Topic 注册</strong>：在 Kafka 中，同一个<strong>Topic 的消息会被分成多个分区</strong>并将其分布在多个 Broker 上，<strong>这些分区信息及与 Broker 的对应关系</strong>也都是由 Zookeeper 在维护。比如我创建了一个名字为 my-topic 的主题并且它有两个分区，对应到 zookeeper 中会创建这些文件夹：<code>/brokers/topics/my-topic/Partitions/0</code>、<code>/brokers/topics/my-topic/Partitions/1</code>，也会记录分区的leader</p>
<p><img src="/%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95%E9%A2%98/image-20231023152301546.png" alt="image-20231023152301546"></p>
<h4 id="Kafka的高可用机制了解吗">Kafka的高可用机制了解吗</h4>
<ul>
<li>集群</li>
<li>多副本机制
<ul>
<li>一个topic有多个分区，每个分区有多个副本，有一个leader，其余的都是follower，副本自然是存储在不同的broker中</li>
<li>所有的分区副本的内容都是相同的，如果leader发生故障。会将follower副本提升为leader，保证系统的容错性、高可用性。</li>
<li>follower副本分为两类副本。一类是ISR，与leader副本同步保存的数据，另一类是普通副本，异步保存的数据。优先从ISR中选取</li>
</ul>
</li>
</ul>
<h4 id="Kafka的数据清理机制了解吗？">Kafka的数据清理机制了解吗？</h4>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_45574582/article/details/130653678">【Kafka面试】Kafka数据清理机制了解过吗？_kafka消息消费完后就删除_TAIKEMAN的博客-CSDN博客</a></p>
<p>首先了解一下Kafka的存储机制，</p>
<ul>
<li>
<p>kafka的topic是一个逻辑概念，真正存储数据的位置是分区**，分区在broker机器上对应的是文件夹（**topic名称-分区号）。</p>
</li>
<li>
<p>分区内部存储了数据文件，也是<strong>分段存储</strong>的。在一个分区下可能存在多个日志分区段（<strong>segment</strong>）</p>
</li>
<li>
<p>每个段都对应了3个文件：.index索引文件、<strong>.log真正的数据文件</strong>、.timeindex时间索引文件（都是按照数据偏移量来命名的）</p>
<p><img src="/%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95%E9%A2%98/image-20231023150052131.png" alt="image-20231023150052131"></p>
</li>
</ul>
<p>为什么要分段？</p>
<ul>
<li>删除无用文件（已经被消费过很长时间的文件）更方便，提高磁盘利用率</li>
<li>查找数据更便捷：如果消息量很大，全都存储在一个文件中，那么查找速度肯定会受限<br>
文件命名都是以偏移量进行命名的：查找数据时，肯定是知道需要查找的偏移量的，此时可以快速定位到某个文件，通过.index索引文件，再去从.log文件中找出具体的数据</li>
</ul>
<p>现在来看看具体的数据清理策略</p>
<ul>
<li>
<h4 id="1-根据消息的保留时间">1. 根据消息的保留时间</h4>
<p><img src="/%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95%E9%A2%98/c5a2a799dbd54565bc8b4018525d94e6.png" alt="在这里插入图片描述"></p>
<ul>
<li>根据消息的保留时间，当消息在Kafka中保存的时间超过了指定的时间，就会触发清理过程</li>
<li>指定时间可以再broker的配置文件中配置，<strong>默认168小时</strong>（7天）</li>
<li>根据业务情况可以适当调整，一般消息都不会保留超过7天的</li>
</ul>
</li>
<li>
<h4 id="2-根据topic存储的数据大小">2. 根据topic存储的数据大小</h4>
<p><img src="/%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95%E9%A2%98/6f2426de7509445fb672ac8be48c27ec.png" alt="在这里插入图片描述"></p>
<ul>
<li>根据topic存储的数据大小（<strong>该topic下所有分区数据的总和</strong>），当topic所占的日志文件大小大于一定阈值（1TB），则开始删除最久的消息</li>
<li>在broker的配置文件中默认是关闭的，<strong>需手动开启</strong></li>
</ul>
</li>
</ul>
<h4 id="kafka的rebalance机制了解吗">kafka的rebalance机制了解吗</h4>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1852157">一文理解Kafka的选举机制与Rebalance机制-腾讯云开发者社区-腾讯云 (tencent.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzUyNzgyNzAwNg==&amp;mid=2247484251&amp;idx=1&amp;sn=92d6b50c5987f4f80316313db05b56ff&amp;scene=21#wechat_redirect">一文快速了解Kafka (qq.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/106104783">kafka重要知识点之消费组概念 - 知乎 (zhihu.com)</a></p>
<p>注意：一个分区的数据只能由消费者组中的一个消费者来消费</p>
<p>在Kafka中，当有新消费者加入或者订阅的Topic数发生变化时，会触发Rebalance(再均衡：<strong>在同一个消费者组当中，分区的所有权从一个消费者转移到另外一个消费者</strong>)机制，Rebalance顾名思义就是重新均衡消费者消费。Rebalance的过程如下：</p>
<h2 id="技能点">技能点</h2>
<h3 id="设计模式">设计模式</h3>
<p>了解哪些设计模式？</p>
<p>Spring框架中涉及的：</p>
<p>自己设计的：</p>
<p><strong>单例模式</strong>：</p>
<p>Spring 中 bean 的默认作用域就是 singleton(单例)的。</p>
<p><strong>使用单例模式的好处</strong> :</p>
<ul>
<li>对于频繁使用的对象，可以省略创建对象所花费的时间，这对于那些重量级对象而言，是非常可观的一笔系统开销；</li>
<li>由于 new 操作的次数减少，因而对系统内存的使用频率也会降低，这将减轻 GC 压力，缩短 GC 停顿时间</li>
</ul>
<p><strong>代理模式：</strong></p>
<p>Spring AOP 就是基于动态代理的，实现功能增强</p>
<p>如果要代理的对象，实现了某个接口，那么 Spring AOP 会使用 <strong>JDK Proxy</strong> 去创建代理对象</p>
<p>而对于没有实现接口的对象，Spring AOP 会使用 <strong>Cglib</strong> 生成一个被代理对象的子类来作为代理</p>
<p><strong>策略模式</strong></p>
<p><strong>责任链模式</strong></p>
<p><strong>工厂方法模式</strong></p>
<p>给每个产品提供了一个工厂，让工厂专门负责对应产品的生产，遵循开闭原则</p>
<p><img src="/%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95%E9%A2%98/image-20231011213744239.png" alt="image-20231011213744239"></p>
<h4 id="SQL优化手段">SQL优化手段</h4>
<ul>
<li>
<p>避免使用select *</p>
</li>
<li>
<p>大数据量分页查询，使用子查询优化</p>
</li>
<li>
<p>选择合适的字段类型</p>
</li>
<li>
<p>尽量用 UNION ALL 代替 UNION</p>
</li>
<li>
<p>批量操作</p>
</li>
<li>
<p>正确使用索引</p>
</li>
</ul>
<p><img src="/%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95%E9%A2%98/image-20231011215134744.png" alt="image-20231011215134744"></p>
<p><img src="/%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95%E9%A2%98/image-20231011215232013.png" alt="image-20231011215232013"></p>
<h4 id="谈谈对微服务的理解">谈谈对微服务的理解</h4>
<ol>
<li>微服务是什么？</li>
</ol>
<p><strong>单个应用程序被划分成各种小的、互相连接的微服务，一个微服务完成一个比较单一的功能，相互之间保持独立和解耦合，这就是微服务架构。</strong></p>
<ol start="2">
<li>单体服务存在的问题</li>
</ol>
<p><strong>某个业务模块负载过高，需要扩展的时候，必须扩展整个应用程序</strong>，这可能导致额外的资源浪费。单体式应用程序由于服务之间的紧密度、相依性过高，这将导致测试、升级有所困难，且开发曲线有可能会在后期大幅度地上升，令开发不易。相较之下「微服务架构」能够解决这个问题。</p>
<ol start="3">
<li>微服务的特点</li>
</ol>
<p>想各个模块业务拆分，一个微服务完成一个比较单一的功能，相互之间保持独立和解耦合，这就是微服务架构。</p>
<p>优点：技术异构性，隔离性，可扩展性，易优化，简单部署</p>
<p>缺点：难管理</p>
<p>解决办法：服务注册与发现，服务监控，日志监控，调用追踪；服务容错（需要引入「熔断、隔离、限流和降级、超时机制」等「服务容错」机制来保证服务持续可用性。）；服务安全</p>
<p>微服务框架一般都包含了<code>RPC</code>的实现和一系列「服务治理」能力，基于这个框架之上实现自己的微服务</p>
<h4 id="了解哪些Linux常用操作命令">了解哪些Linux常用操作命令</h4>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/w3cnote/linux-useful-command.html">Linux 需要掌握的一些命令 | 菜鸟教程 (runoob.com)</a></p>
<p>目录切换 cd</p>
<p>目录操作  ls mkdir</p>
<p><code>find [路径] [表达式]</code>：在指定目录及其子目录中搜索文件或目录（查），非常强大灵活。</p>
<p><code>mv [选项] 源文件/目录 目标文件/目录</code>：移动文件或目录（移），也可以用于重命名文件或目录。</p>
<p>文件操作</p>
<p>vim 文件名</p>
<p>cat/more/less/tail 文件名</p>
<p>文件压缩</p>
<p><code>tar -zcvf</code> 打包压缩后的文件名 要打包压缩的文件</p>
<p>文件传输</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scp [选项] 源文件 远程文件</span><br><span class="line">scp -r my_directory user@remote:/home/user</span><br></pre></td></tr></table></figure>
<p><strong>修改文件/目录的权限的命令：<code>chmod</code></strong></p>
<p>Linux在文件中查找字符串</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">grep -rn &quot;hello,world!&quot; *</span><br><span class="line">* : 表示当前目录所有文件，也可以是某个文件名</span><br><span class="line"></span><br><span class="line">-r 是递归查找</span><br><span class="line"></span><br><span class="line">-n 是显示行号</span><br><span class="line"></span><br><span class="line">-R 查找所有文件包含子目录</span><br><span class="line"></span><br><span class="line">-i 忽略大小写</span><br></pre></td></tr></table></figure>
<ul>
<li>查看内存状态的命令   free</li>
<li>查看cpu的使用率  ps</li>
</ul>
<h4 id="谈谈对ThreadLocal的了解">谈谈对ThreadLocal的了解</h4>
<h4 id="java自定义线程池几个参数，以及他们的作用？">java自定义线程池几个参数，以及他们的作用？</h4>
<p><a target="_blank" rel="noopener" href="https://javaguide.cn/java/concurrent/java-concurrent-questions-03.html#threadlocal-%E5%86%85%E5%AD%98%E6%B3%84%E9%9C%B2%E9%97%AE%E9%A2%98%E6%98%AF%E6%80%8E%E4%B9%88%E5%AF%BC%E8%87%B4%E7%9A%84">Java并发常见面试题总结（下） | JavaGuide(Java面试 + 学习指南)</a></p>
<h4 id="说一下Syncnoized锁升级？">说一下Syncnoized锁升级？</h4>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7232524757526429756">深入理解 synchronized 的锁升级 - 掘金 (juejin.cn)</a></p>
<p>在 JDK 1.6 之前，使用 synchronized 关键字需要依赖于<strong>底层操作系统的 Mutex Lock</strong> 实现互斥锁的功能，metux是系统方法。应用程序调用的时候需要从用户态切换到内核态，这样就涉及到用户态向内核态的切换，带来性能上的损耗。</p>
<p>在 JDK 1.6 之后，引入了<strong>偏向锁</strong>与<strong>轻量锁</strong>来减小获取和释放锁所带来的性能消耗，也就是<strong>不再是一上来就需要切换 CPU 状态导致效率低下而是通过锁升级的方式逐步增大性能消耗</strong>，从而避免了一些无需使用重量级锁的情况的性能消耗问题。</p>
<p>线程去访问synchronized 同步代码块时，synchronized 根据线程的竞争情况，先去尝试在不加重量级锁的情况去保证线程安全性，引入偏向锁和轻量级锁。</p>
<p>偏向锁升级：<strong>JVM 会使用 CAS 操作把当前线程 ID 记录到作为锁的对象的 Mark Word 中占用 54 bit 的 ThreadID 字段中</strong>，同时会修改偏向锁位置为 1，表示当前线程获得该锁。此时的锁对象由无锁状态变为偏向锁状态。</p>
<p>在当前线程再次访问该同步代码时，<strong>JVM 通过锁对象的对象头的 Mark Word 判断 ThreadID 字段是否与当前线程 ID 一致</strong>，一致则说明当前线程还持有该锁对象，可以直接进入同步代码（偏向锁不会在线程执行完同步代码后就释放，也就是线程不会主动释放偏向锁）</p>
<p>可以看到通过这种方式无需切换 CPU 状态，也就是不用操作系统接入。<strong>偏向锁其实就是在没有其他线程的竞争下，一直偏向于同一线程，该线程可以一直访问同步代码，而无需重复加锁</strong>。所以使用偏向锁几乎没有额外的开销，性能极高。</p>
<p>轻量级锁升级：当线程 A 与 线程 B 同时抢占锁对象时，偏向锁会被撤销并将锁升级为轻量级锁，这个升级过程如下：</p>
<p>线程 A 在执行同步代码前，JVM 在线程的栈帧中创建用于存储锁记录的空间 Lock Record。当线程 A 抢占锁对象时，JVM 使用 CAS 操作将锁对象的对象头的 Mark Word 拷贝进线程 A 的锁记录 Lock Record 中（这个拷贝 Mark Word 的过程官方称为 <strong>Displaced Mark Word</strong>），并且<strong>将 Mark Word 中指向线程栈中 Lock Record 的指针指向线程 A 的锁空间</strong>。</p>
<p>重量级锁升级：当<strong>存在两个以上的线程竞争同一把锁</strong>或<strong>线程竞争轻量级锁自旋多次仍然失败</strong>时，会导致锁升级为重量级锁。重量级锁会直接阻塞持有锁的线程以外的所有线程，防止 CPU 空转，减小 CPU 的开销。</p>
<p><img src="/%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95%E9%A2%98/image-20231015191241771.png" alt="image-20231015191241771"></p>
<h4 id="能说一下hashMap和ConCurrenthhashMap的区别吗？底层数据结构">能说一下hashMap和ConCurrenthhashMap的区别吗？底层数据结构</h4>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_29051413/article/details/107869427">深入浅出ConcurrentHashMap详解-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/346803874">面试 ConcurrentHashMap ，看这一篇就够了！ - 知乎 (zhihu.com)</a></p>
<p><strong>jdk1.8之前</strong></p>
<p><img src="/%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95%E9%A2%98/java7_concurrenthashmap.png" alt="Java7 ConcurrentHashMap 存储结构"></p>
<p>一个 <code>ConcurrentHashMap</code> 里包含一个 <code>Segment</code> 数组，<code>Segment</code> 的个数一旦<strong>初始化就不能改变</strong>。 <code>Segment</code> 数组的大小默认是 16，也就是说默认可以同时支持 16 个线程并发写。</p>
<p><strong>ConcurrentHashMap 是一个二级哈希表。在一个总的哈希表下面，有若干个子哈希表。</strong></p>
<p><code>Segment</code> 的结构和 <code>HashMap</code> 类似，是一种数组和链表结构，一个 <code>Segment</code> 包含一个 <code>HashEntry</code> 数组，每个 <code>HashEntry</code> 是一个链表结构的元素，每个 <code>Segment</code> 守护着一个 <code>HashEntry</code> 数组里的元素，当对 <code>HashEntry</code> 数组的数据进行修改时，必须首先获得对应的 <code>Segment</code> 的锁。也就是说，对同一 <code>Segment</code> 的并发写入会被阻塞，不同 <code>Segment</code> 的写入是可以并发执行的。</p>
<p><strong>jdk 1.8</strong></p>
<p><code>ConcurrentHashMap</code> 取消了 <code>Segment</code> 分段锁，采用 <code>Node + CAS + synchronized</code> 来保证并发安全。数据结构跟 <code>HashMap</code> 1.8 的结构类似，数组+链表/红黑二叉树。Java 8 在链表长度超过一定阈值（8）时将链表（寻址时间复杂度为 O(N)）转换为红黑树（寻址时间复杂度为 O(log(N))）</p>
<h4 id="AOF哪些过程时阻塞主进程的">AOF哪些过程时阻塞主进程的</h4>
<ul>
<li>创建子进程的途中，由于要复制父进程的页表等数据结构，阻塞的时间跟页表的大小有关，页表越大，阻塞的时间也越长；</li>
<li>创建完子进程后，如果子进程或者父进程修改了共享数据，就会发生写时复制，这期间会拷贝物理内存，如果内存越大，自然阻塞的时间也越长；</li>
</ul>
<h4 id="redis集群选取主节点过程">redis集群选取主节点过程</h4>
<p><img src="/%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95%E9%A2%98/%E9%80%89%E4%B8%BB%E8%BF%87%E7%A8%8B.webp" alt="img"></p>
<p>•首先判断主与从节点断开时间长短，如超过指定值就排该从节点</p>
<p>•然后判断从节点的slave-priority值，越小优先级越高</p>
<p>•如果slave-prority一样，则判断slave节点的offset值，越大优先级越高</p>
<p>•最后是判断slave节点的运行id大小，越小优先级越高。</p>
<h4 id="jvm堆的比例">jvm堆的比例</h4>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7289342533092606007">JVM内存结构揭秘：堆内存的奥秘 - 掘金 (juejin.cn)</a></p>
<ul>
<li>新生代与老年代空间默认比例 1:2：JVM 调参数，XX:NewRatio=2，表示新生代占 1，老年代占 2，新生代占整个堆的 1/3。</li>
<li>Eden 空间和另外两个 Survivor 空间缺省所占的比例是：8:1:1。</li>
</ul>
<h4 id="Mybatis核心组件">Mybatis核心组件</h4>
<h4 id="如何解决http的无状态？">如何解决http的无状态？</h4>
<p><strong>面试题：Session如何解决cookie的安全问题？</strong></p>
<p>在只用cookie的情况下，要保持会话连接，服务器记住浏览器的状态。我们需要在手动创建cookie，将<code>username:xxx</code>这种形式的能表明用户身份的数据发送给客户端，客户端下次再访问，自动携带cookie，服务端通过key获取cookie里面的具体信息，从而知道还是上次那个用户来访问，实现“记住”的效果。</p>
<p>然而这样是不安全的，因为cookie是存放在客户端的，用户可以修改cookie的，从而会导致信息用户身份错乱。更加严重的是，cookie要是存放密码之类的隐私信息就跟糟糕了。</p>
<p>session如何解决的呢？</p>
<p>首先需要强调的是，session依靠cookie实现的。</p>
<p>我们将当前登录用户的必要信息存放在服务器端session对象中，每个session会自动创建一个sessonId，并绑定该session对象，以cookie的形式发送给用户。这样用户浏览器中的cookie只会存放一个sessionID，这并不是什么隐私数据，且无法伪造，因为服务器后台还有一个sessionId，只有两者一致，才会获得session对象中的用户信息。</p>
<p>所以，session可以解决安全问题。本质是因为session把用户信息存放到服务器端这种安全的环境中，并依靠cookie存放不涉密的sessionId进行认证。</p>
<p><strong>面试题：在分布式部署中，为什么不使用session呢？</strong></p>
<p>因为服务器是分布式部署的（承载大流量），浏览器访问的是服务器代替nginx，nginx按照负载均衡的原则分配请求。在多次请求的过程中，可能会有多台服务器处理同一个浏览器的请求，但session只保存在一台服务器中。</p>
<p>解决策略：</p>
<p>1、粘性session：在nginx中提供一致性哈希策略，可以保持用户ip进行hash值计算固定分配到某台服务器上，负载也比较均衡，其问题是假如有一台服务器挂了，session也丢失了。</p>
<p>2、同步session：当某一台服务器存了session后，同步到其他服务器中，其问题是同步session到其他服务器会对服务器性能产生影响，服务器之间耦合性较强。</p>
<p>3、共享session：单独搞一台服务器用来存session，其他服务器都向这台服务器获取session，其问题是这台服务器挂了，session就全部丢失。</p>
<p>4、redis集中管理session(主流方法)：redis为内存数据库，读写效率高，并可在集群环境下做高可用。</p>
<p><img src="/%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230908140746494.png" alt="image-20230908140746494"></p>
<p>常用解决方案：一般数据都使用cookie而不是session，必要重要/敏感的数据存到数据库（集群）（非关系型数据库redis）里。</p>
<p><img src="/%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230908140902102.png" alt="image-20230908140902102"></p>
<h4 id="threadLocal如何线程隔离的？">threadLocal如何线程隔离的？</h4>
<h4 id="threadLocal有什么使用风险？如何解决">threadLocal有什么使用风险？如何解决</h4>
<h4 id="Spring事务管理？">Spring事务管理？</h4>
<h4 id="JDBC的执行流程？">JDBC的执行流程？</h4>
<p>JDBC是一种用于执行 SQL 语句的 Java API，是 Java 应用连接各种关系型数据库的基本的接口。可以为多种关系数据库提供统一访问。</p>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/w3cnote/jdbc-use-guide.html">JDBC 使用说明 | 菜鸟教程 (runoob.com)</a></p>
<h4 id="Mybatis执行流程">Mybatis执行流程</h4>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/w3cnote/jdbc-use-guide.html">JDBC 使用说明 | 菜鸟教程 (runoob.com)</a></p>
<h4 id="bean的生命周期了解吗">bean的生命周期了解吗</h4>
<p>嗯。。。</p>
<ol>
<li>实例化，执行构造器</li>
<li>依赖注入，将xml配置的属性，set给bean的属性</li>
<li>（如果实现了BeanPostProcessor接口，并配置好交给Spring容器管理）那么初始化前，bean的后置处理器 BeanPostProcessor，执行beforeInitialization方法。</li>
<li>初始化，定义myinit()方法,且在xml的init-method属性中指定了</li>
<li>（如果实现了BeanPostProcessor接口，并配置好交给Spring容器管理）那么初始化前，bean的后置处理器 BeanPostProcessor，执行afterInitialization方法。</li>
<li>使用bean</li>
<li>（如果 Bean 在配置文件中的定义包含 destroy-method 属性，执行指定的方法）销毁bean</li>
</ol>
<p>十步骤：</p>
<ol>
<li>实例化，执行构造器。</li>
<li>依赖注入，将xml配置的属性，set给bean的属性</li>
<li><strong>(如果bean实现了BeanNameAware接口），那么就会调用 setBeanName()方法，传入 Bean 的名字</strong></li>
<li>（如果实现了BeanPostProcessor接口，并配置好交给Spring容器管理）那么初始化前，bean的后置处理器 BeanPostProcessor，执行beforeInitialization方法。</li>
<li><strong>（如果 Bean 实现了InitializingBean接口），执行afterPropertiesSet()方法。</strong></li>
<li>初始化，定义myinit()方法,且在xml的init-method属性中指定了</li>
<li>（如果实现了BeanPostProcessor接口，并配置好交给Spring容器管理）那么初始化前，bean的后置处理器 BeanPostProcessor，执行afterInitialization方法。</li>
<li>使用bean</li>
<li><strong>当要销毁 Bean 的时候，如果 Bean 实现了 DisposableBean 接口，执行 destroy() 方法</strong></li>
<li>（如果 Bean 在配置文件中的定义包含 destroy-method 属性，执行指定的方法）销毁bean</li>
</ol>
<h4 id="Spring解决循环依赖？">Spring解决循环依赖？</h4>
<p><a target="_blank" rel="noopener" href="https://www.iamshuaidi.com/3198.html">Spring如何解决循环依赖问题(超详细)-帅地玩编程 (iamshuaidi.com)</a></p>
<p><img src="/%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95%E9%A2%98/image-20231018161423422.png" alt="image-20231018161423422"></p>
<h4 id="什么是函数式接口？">什么是函数式接口？</h4>
<p><strong>定义</strong>：也称 SAM 接口，即 Single Abstract Method interfaces，<strong>有且只有一个抽象方法</strong>，但可以有多个非抽象方法的接口。</p>
<p>在 java 8 中专门有一个包放函数式接口<code>java.util.function</code>，该包下的所有接口都有 <code>@FunctionalInterface</code> 注解，提供函数式编程。</p>
<p>在其他包中也有函数式接口，其中一些没有<code>@FunctionalInterface</code> 注解，但是只要符合函数式接口的定义就是函数式接口，与是否有<code>@FunctionalInterface</code>注解无关，注解只是在编译时起到强制规范定义的作用。其在 Lambda 表达式中有广泛的应用。</p>
<p><img src="/%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95%E9%A2%98/683398646b42b8c231d142c8ba7bfa2b.png" alt="image-20200812143426348"></p>
<ol>
<li>Function 函数型接口</li>
</ol>
<p><img src="/%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95%E9%A2%98/5012bef99a9082398d6791311edef491.png" alt="image-20200812144105334"></p>
<ol start="2">
<li>Predicate 断定型接口</li>
</ol>
<p><img src="/%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95%E9%A2%98/12588446b54d93dc56bd005cfaa31a79.png" alt="image-20200812144545558"></p>
<ol start="3">
<li>
<p>Suppier 供给型接口</p>
<p><img src="/%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95%E9%A2%98/ff6aa0d95bf9f22b1f2dd5714f3db542.png" alt="image-20200812144653640"></p>
</li>
<li>
<p>Consummer 消费型接口</p>
<p><img src="/%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95%E9%A2%98/772c811d116f54e0c739929ab392de25.png" alt="image-20200812144803229"></p>
</li>
</ol>
<h4 id="什么是Stream流">什么是Stream流</h4>
<p>java 新增了 <code>java.util.stream</code> 包，它和之前的流大同小异。之前接触最多的是资源流，比如<code>java.io.FileInputStream</code>，通过流把文件从一个地方输入到另一个地方，它只是内容搬运工，对文件内容不做任何<em>CRUD</em>。</p>
<p><code>Stream</code>依然不存储数据，不同的是它可以检索(Retrieve)和逻辑处理集合数据、包括筛选（filter）、排序sorted、统计(Max,Min,Average,Sum)、计数(count)等。可以想象成是 Sql 语句。</p>
<p>它的源数据可以是 <code>Collection</code>、<code>Array</code> 等。由于它的方法参数都是函数式接口类型，所以一般和 Lambda 配合使用。</p>
<h4 id="CSA工作机制了解吗">CSA工作机制了解吗</h4>
<p>CAS是多线程下保证原子性的一种实现。</p>
<p>它是由unsafe类的native方法实现的，有多个方法，比如<code>compareAndSwapObject</code>，<code>compareAndSwapInt</code>，</p>
<p><code>compareAndSwapLong</code>。</p>
<p>CAS 操作包含三个操作数——内存位置偏移量offset、预期原值及新值。</p>
<p>在调用<code>compareAndSwapInt</code>方法后，会直接返回<code>true</code>或<code>false</code>的修改结果，因此需要我们在代码中手动添加自旋的逻辑。</p>
<p><code>Unsafe</code> 提供的 CAS 方法（如 <code>compareAndSwapXXX</code>）底层实现是一条cpu的原子指令。</p>
<p>目前应用在JUC的原子类上，AQS获取state上，concurrentHashMap上。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	*  CAS</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> o         包含要修改field的对象</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> offset    对象中某field的偏移量</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> expected  期望值</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> update    更新值</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span>          true | false</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="type">boolean</span> <span class="title function_">compareAndSwapObject</span><span class="params">(Object o, <span class="type">long</span> offset,  Object expected, Object update)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="type">boolean</span> <span class="title function_">compareAndSwapInt</span><span class="params">(Object o, <span class="type">long</span> offset, <span class="type">int</span> expected,<span class="type">int</span> update)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="type">boolean</span> <span class="title function_">compareAndSwapLong</span><span class="params">(Object o, <span class="type">long</span> offset, <span class="type">long</span> expected, <span class="type">long</span> update)</span>;</span><br></pre></td></tr></table></figure>
<h4 id="volatile">volatile</h4>
<p>可见性：cpu缓存角度理解<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42717648/article/details/130727625#:~:text=%E5%8F%AF%E8%A7%81%E6%80%A7%E9%97%AE%E9%A2%98%E6%98%AF%E5%9F%BA%E4%BA%8E,%E6%95%88%E7%8E%87%E8%82%AF%E5%AE%9A%E4%BC%9A%E6%8F%90%E5%8D%87%E3%80%82">并发编程三大特性：2、可见性（什么是可见性、解决可见性的方式）_cpu 可见性-CSDN博客</a></p>
<p>有序性：计组指令流水线优化角度 <a target="_blank" rel="noopener" href="https://blog.csdn.net/I_r_o_n_M_a_n/article/details/120124198">JUC并发编程 共享模式之内存 有序性 – 有序性(指令重排序优化 &amp; 支持流水线的处理器 &amp; 指令重排序的问题/验证/禁用)_有序性和指令重排_CodeJiao的博客-CSDN博客</a></p>
<h4 id="了解哪些线程安全集合？">了解哪些线程安全集合？</h4>
<p>List类的话</p>
<p><code>Vector</code></p>
<p><code>CopyOnWriteArrayList</code>：写入时复制！适合读多写少的场景</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/u010002184/article/details/90452918">CopyOnWriteArrayList原理，优缺点，使用场景-CSDN博客</a></p>
<p>Map:</p>
<p><code>HashTable</code>：</p>
<p><code>ConcurrentHashMap</code></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://hupingsheng.com">huxianseng</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://hupingsheng.com/%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95%E9%A2%98/">http://hupingsheng.com/面试题/简历面试/简历面试题/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://hupingsheng.com" target="_blank">胡大仙</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/images/home.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/images/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/images/wechat.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/images/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/images/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/%E9%9D%A2%E8%AF%95%E9%A2%98/JavaSE/Java%E5%9F%BA%E7%A1%80/java8%E6%96%B0%E7%89%B9%E6%80%A7/" title=""><img class="cover" src="/images/home.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info"></div></div></a></div><div class="next-post pull-right"><a href="/%E7%AE%97%E6%B3%95/%E7%AE%97%E6%B3%95/" title="算法题"><img class="cover" src="/images/home.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">算法题</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/images/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">huxianseng</div><div class="author-info__description">日拱一卒，功不唐捐!</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">53</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">19</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/hupingsheng"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/hupingsheng" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:hu942658636@163.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E6%88%91%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">自我介绍</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE"><span class="toc-number"></span> <span class="toc-text">项目</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%92%E5%8A%A8%E6%B8%B8%E6%88%8F%E7%A4%BE%E5%8C%BA"><span class="toc-number">1.</span> <span class="toc-text">互动游戏社区</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%80%E8%BF%91%E5%81%9A%E7%9A%84%E4%B8%80%E4%B8%AA%E9%A1%B9%E7%9B%AE%EF%BC%9F"><span class="toc-number">1.1.</span> <span class="toc-text">最近做的一个项目？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%99%E4%B8%AA%E9%A1%B9%E7%9B%AE%E9%81%87%E5%88%B0%E4%BB%80%E4%B9%88%E9%9A%BE%E7%82%B9%EF%BC%9F"><span class="toc-number">1.2.</span> <span class="toc-text">这个项目遇到什么难点？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%99%E4%B8%AA%E9%A1%B9%E7%9B%AEWebSocket%E6%80%8E%E4%B9%88%E7%94%A8%E7%9A%84%EF%BC%9F"><span class="toc-number">1.3.</span> <span class="toc-text">这个项目WebSocket怎么用的？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%99%E4%B8%AA%E9%A1%B9%E7%9B%AE%E6%98%AF%E6%80%8E%E4%B9%88%E7%94%A8%E7%9A%84concurrentHashMap%E7%9A%84%EF%BC%9F"><span class="toc-number">1.4.</span> <span class="toc-text">这个项目是怎么用的concurrentHashMap的？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ConcurrentHashMap%E6%80%8E%E4%B9%88%E5%81%9A%E5%88%B0%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E7%9A%84"><span class="toc-number">1.5.</span> <span class="toc-text">ConcurrentHashMap怎么做到线程安全的</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%99%E4%B8%AA%E9%A1%B9%E7%9B%AE%E5%93%AA%E9%87%8C%E7%94%A8%E5%88%B0%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9A%84%EF%BC%9F%E7%94%A8%E4%BB%80%E4%B9%88%E6%96%B9%E5%BC%8F%E5%88%9B%E5%BB%BA%E7%BA%BF%E7%A8%8B%E7%9A%84"><span class="toc-number">1.6.</span> <span class="toc-text">这个项目哪里用到多线程的？用什么方式创建线程的</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E4%B8%BA%E4%BB%80%E4%B9%88%E7%94%A8%E5%88%B0ReentrantLock%E7%9A%84%EF%BC%9F"><span class="toc-number">1.7.</span> <span class="toc-text">项目为什么用到ReentrantLock的？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E4%B8%AD%E6%9C%89redis%EF%BC%8C%E4%B8%BB%E8%A6%81%E5%AD%98%E5%82%A8%E4%BA%86%E5%93%AA%E4%BA%9B%E4%BF%A1%E6%81%AF%EF%BC%9F"><span class="toc-number">1.8.</span> <span class="toc-text">项目中有redis，主要存储了哪些信息？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E6%9C%89%E7%94%A8%E5%88%B0%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86%EF%BC%9F"><span class="toc-number">1.9.</span> <span class="toc-text">项目有用到事务管理？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E5%81%9A%E4%BB%80%E4%B9%88%E7%9A%84%EF%BC%9F%E4%BD%BF%E7%94%A8%E4%BB%80%E4%B9%88%E6%8A%80%E6%9C%AF%E7%9A%84%EF%BC%9F"><span class="toc-number">1.10.</span> <span class="toc-text">项目定时任务做什么的？使用什么技术的？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A2%E7%84%B6redis%E4%BD%9C%E4%B8%BA%E7%BC%93%E5%AD%98%E4%BA%86%EF%BC%8C%E9%82%A3%E4%B9%88%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E5%92%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E4%B8%80%E8%87%B4%E6%80%A7%E5%91%A2%EF%BC%9F"><span class="toc-number">1.11.</span> <span class="toc-text">既然redis作为缓存了，那么如何保证和数据库的一致性呢？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%99%E4%B8%AA%E9%A1%B9%E7%9B%AE%E6%9C%89%E7%94%A8%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6%EF%BC%9FKafka"><span class="toc-number">1.12.</span> <span class="toc-text">这个项目有用消息中间件？Kafka?</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E7%9A%84%E8%AF%84%E8%AE%BA%E5%8A%9F%E8%83%BD%EF%BC%8C%E8%A1%A8%E7%9A%84%E5%AD%97%E6%AE%B5%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E7%9A%84%EF%BC%9F"><span class="toc-number">1.13.</span> <span class="toc-text">项目的评论功能，表的字段如何设计的？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#redis%E4%BD%9C%E4%B8%BA%E7%BC%93%E5%AD%98%EF%BC%8C%E6%8C%81%E4%B9%85%E5%8C%96%E6%80%8E%E4%B9%88%E5%81%9A%E5%88%B0%E7%9A%84"><span class="toc-number">1.14.</span> <span class="toc-text">redis作为缓存，持久化怎么做到的</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E6%80%8E%E4%B9%88%E4%BD%BF%E7%94%A8HyperLogLog-%E5%92%8C-BitMap%E7%9A%84%EF%BC%9F"><span class="toc-number">1.15.</span> <span class="toc-text">项目怎么使用HyperLogLog 和 BitMap的？</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-number">2.</span> <span class="toc-text">拦截器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Controller"><span class="toc-number">3.</span> <span class="toc-text">Controller</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E4%B9%A0%E9%A1%B9%E7%9B%AE"><span class="toc-number">4.</span> <span class="toc-text">实习项目</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D%E4%B8%80%E4%B8%8B%E5%AE%9E%E4%B9%A0%E5%81%9A%E7%9A%84%E4%BA%8B%E6%83%85"><span class="toc-number">4.1.</span> <span class="toc-text">介绍一下实习做的事情</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D%E4%B8%80%E4%B8%8B%E5%AE%9E%E4%B9%A0%E7%9A%84%E9%A1%B9%E7%9B%AE"><span class="toc-number">4.2.</span> <span class="toc-text">介绍一下实习的项目</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%99%E4%B8%AA%E9%A1%B9%E7%9B%AE%E6%9C%89%E5%93%AA%E4%BA%9B%E6%9D%83%E9%99%90%E5%95%8A%EF%BC%9F"><span class="toc-number">4.3.</span> <span class="toc-text">这个项目有哪些权限啊？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D%E4%B8%80%E4%B8%8B%E4%BD%A0%E6%98%AF%E6%80%8E%E4%B9%88%E5%81%9A%E6%9D%83%E9%99%90%E7%B3%BB%E7%BB%9F%E7%9A%84%E3%80%82"><span class="toc-number">4.4.</span> <span class="toc-text">介绍一下你是怎么做权限系统的。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%9A%84%EF%BC%9F"><span class="toc-number">4.5.</span> <span class="toc-text">单点登录如何实现的？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E8%AE%A4%E8%AF%81%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%EF%BC%9F"><span class="toc-number">4.6.</span> <span class="toc-text">权限认证如何实现？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0%E6%95%B0%E6%8D%AE%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7%E4%BD%A0%E4%BB%AC%E6%80%8E%E4%B9%88%E6%8E%A7%E5%88%B6%EF%BC%9F%EF%BC%88%E7%BD%91%E7%BB%9C%E4%BC%A0%E8%BE%93%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7%EF%BC%89"><span class="toc-number">4.7.</span> <span class="toc-text">上传数据的安全性你们怎么控制？（网络传输的安全性）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E7%9A%84%E6%97%A5%E5%BF%97%E6%98%AF%E6%80%8E%E4%B9%88%E9%87%87%E9%9B%86%E7%9A%84%EF%BC%9F"><span class="toc-number">4.8.</span> <span class="toc-text">项目的日志是怎么采集的？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%97%A5%E5%BF%97%E7%9A%84%E5%91%BD%E4%BB%A4"><span class="toc-number">4.9.</span> <span class="toc-text">查看日志的命令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Kafka"><span class="toc-number">5.</span> <span class="toc-text">Kafka</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Kafka%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%99%E4%B9%88%E5%BF%AB%EF%BC%9F-%E9%AB%98%E5%90%9E%E5%90%90%E9%87%8F"><span class="toc-number">5.1.</span> <span class="toc-text">Kafka为什么这么快？(高吞吐量)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E6%98%AF%E5%A6%82%E4%BD%95%E7%AE%A1%E7%90%86kafka%E7%9A%84"><span class="toc-number">5.2.</span> <span class="toc-text">项目是如何管理kafka的</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#kafka%E6%98%AF%E5%A6%82%E4%BD%95%E4%BD%9C%E4%B8%BA%E4%B8%80%E4%B8%AA%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E6%A8%A1%E5%9E%8B%E7%9A%84"><span class="toc-number">5.3.</span> <span class="toc-text">kafka是如何作为一个消息队列模型的</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Kafka-%E5%A4%9A%E5%89%AF%E6%9C%AC%EF%BC%88Replica%EF%BC%89%E6%9C%BA%E5%88%B6%E6%9C%89%E4%BB%80%E4%B9%88%E5%A5%BD%E5%A4%84%E5%91%A2%EF%BC%9F"><span class="toc-number">5.4.</span> <span class="toc-text">Kafka 多副本（Replica）机制有什么好处呢？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#KafKa%E7%9A%84%E5%A4%9A%E5%88%86%E5%8C%BA%EF%BC%88Partition%EF%BC%89%E6%9C%BA%E5%88%B6%E6%9C%89%E4%BB%80%E4%B9%88%E5%A5%BD%E5%A4%84%EF%BC%9F"><span class="toc-number">5.5.</span> <span class="toc-text">KafKa的多分区（Partition）机制有什么好处？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0Kafka%E7%9A%84%E9%A1%BA%E5%BA%8F%E6%B6%88%E8%B4%B9"><span class="toc-number">5.6.</span> <span class="toc-text">如何实现Kafka的顺序消费</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#kafka%E4%B8%ADzookeeper%E7%9A%84%E4%BD%9C%E7%94%A8%EF%BC%9F"><span class="toc-number">5.7.</span> <span class="toc-text">kafka中zookeeper的作用？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Kafka%E7%9A%84%E9%AB%98%E5%8F%AF%E7%94%A8%E6%9C%BA%E5%88%B6%E4%BA%86%E8%A7%A3%E5%90%97"><span class="toc-number">5.8.</span> <span class="toc-text">Kafka的高可用机制了解吗</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Kafka%E7%9A%84%E6%95%B0%E6%8D%AE%E6%B8%85%E7%90%86%E6%9C%BA%E5%88%B6%E4%BA%86%E8%A7%A3%E5%90%97%EF%BC%9F"><span class="toc-number">5.9.</span> <span class="toc-text">Kafka的数据清理机制了解吗？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%A0%B9%E6%8D%AE%E6%B6%88%E6%81%AF%E7%9A%84%E4%BF%9D%E7%95%99%E6%97%B6%E9%97%B4"><span class="toc-number">5.10.</span> <span class="toc-text">1. 根据消息的保留时间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%A0%B9%E6%8D%AEtopic%E5%AD%98%E5%82%A8%E7%9A%84%E6%95%B0%E6%8D%AE%E5%A4%A7%E5%B0%8F"><span class="toc-number">5.11.</span> <span class="toc-text">2. 根据topic存储的数据大小</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#kafka%E7%9A%84rebalance%E6%9C%BA%E5%88%B6%E4%BA%86%E8%A7%A3%E5%90%97"><span class="toc-number">5.12.</span> <span class="toc-text">kafka的rebalance机制了解吗</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%80%E8%83%BD%E7%82%B9"><span class="toc-number"></span> <span class="toc-text">技能点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.</span> <span class="toc-text">设计模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SQL%E4%BC%98%E5%8C%96%E6%89%8B%E6%AE%B5"><span class="toc-number">1.1.</span> <span class="toc-text">SQL优化手段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B0%88%E8%B0%88%E5%AF%B9%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%9A%84%E7%90%86%E8%A7%A3"><span class="toc-number">1.2.</span> <span class="toc-text">谈谈对微服务的理解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%86%E8%A7%A3%E5%93%AA%E4%BA%9BLinux%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4"><span class="toc-number">1.3.</span> <span class="toc-text">了解哪些Linux常用操作命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B0%88%E8%B0%88%E5%AF%B9ThreadLocal%E7%9A%84%E4%BA%86%E8%A7%A3"><span class="toc-number">1.4.</span> <span class="toc-text">谈谈对ThreadLocal的了解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#java%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%87%A0%E4%B8%AA%E5%8F%82%E6%95%B0%EF%BC%8C%E4%BB%A5%E5%8F%8A%E4%BB%96%E4%BB%AC%E7%9A%84%E4%BD%9C%E7%94%A8%EF%BC%9F"><span class="toc-number">1.5.</span> <span class="toc-text">java自定义线程池几个参数，以及他们的作用？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B4%E4%B8%80%E4%B8%8BSyncnoized%E9%94%81%E5%8D%87%E7%BA%A7%EF%BC%9F"><span class="toc-number">1.6.</span> <span class="toc-text">说一下Syncnoized锁升级？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%BD%E8%AF%B4%E4%B8%80%E4%B8%8BhashMap%E5%92%8CConCurrenthhashMap%E7%9A%84%E5%8C%BA%E5%88%AB%E5%90%97%EF%BC%9F%E5%BA%95%E5%B1%82%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">1.7.</span> <span class="toc-text">能说一下hashMap和ConCurrenthhashMap的区别吗？底层数据结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AOF%E5%93%AA%E4%BA%9B%E8%BF%87%E7%A8%8B%E6%97%B6%E9%98%BB%E5%A1%9E%E4%B8%BB%E8%BF%9B%E7%A8%8B%E7%9A%84"><span class="toc-number">1.8.</span> <span class="toc-text">AOF哪些过程时阻塞主进程的</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#redis%E9%9B%86%E7%BE%A4%E9%80%89%E5%8F%96%E4%B8%BB%E8%8A%82%E7%82%B9%E8%BF%87%E7%A8%8B"><span class="toc-number">1.9.</span> <span class="toc-text">redis集群选取主节点过程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#jvm%E5%A0%86%E7%9A%84%E6%AF%94%E4%BE%8B"><span class="toc-number">1.10.</span> <span class="toc-text">jvm堆的比例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mybatis%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6"><span class="toc-number">1.11.</span> <span class="toc-text">Mybatis核心组件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3http%E7%9A%84%E6%97%A0%E7%8A%B6%E6%80%81%EF%BC%9F"><span class="toc-number">1.12.</span> <span class="toc-text">如何解决http的无状态？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#threadLocal%E5%A6%82%E4%BD%95%E7%BA%BF%E7%A8%8B%E9%9A%94%E7%A6%BB%E7%9A%84%EF%BC%9F"><span class="toc-number">1.13.</span> <span class="toc-text">threadLocal如何线程隔离的？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#threadLocal%E6%9C%89%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8%E9%A3%8E%E9%99%A9%EF%BC%9F%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3"><span class="toc-number">1.14.</span> <span class="toc-text">threadLocal有什么使用风险？如何解决</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Spring%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86%EF%BC%9F"><span class="toc-number">1.15.</span> <span class="toc-text">Spring事务管理？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#JDBC%E7%9A%84%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B%EF%BC%9F"><span class="toc-number">1.16.</span> <span class="toc-text">JDBC的执行流程？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mybatis%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="toc-number">1.17.</span> <span class="toc-text">Mybatis执行流程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#bean%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E4%BA%86%E8%A7%A3%E5%90%97"><span class="toc-number">1.18.</span> <span class="toc-text">bean的生命周期了解吗</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Spring%E8%A7%A3%E5%86%B3%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96%EF%BC%9F"><span class="toc-number">1.19.</span> <span class="toc-text">Spring解决循环依赖？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%87%BD%E6%95%B0%E5%BC%8F%E6%8E%A5%E5%8F%A3%EF%BC%9F"><span class="toc-number">1.20.</span> <span class="toc-text">什么是函数式接口？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFStream%E6%B5%81"><span class="toc-number">1.21.</span> <span class="toc-text">什么是Stream流</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CSA%E5%B7%A5%E4%BD%9C%E6%9C%BA%E5%88%B6%E4%BA%86%E8%A7%A3%E5%90%97"><span class="toc-number">1.22.</span> <span class="toc-text">CSA工作机制了解吗</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#volatile"><span class="toc-number">1.23.</span> <span class="toc-text">volatile</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%86%E8%A7%A3%E5%93%AA%E4%BA%9B%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E9%9B%86%E5%90%88%EF%BC%9F"><span class="toc-number">1.24.</span> <span class="toc-text">了解哪些线程安全集合？</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/%E9%9D%A2%E8%AF%95%E9%A2%98/JavaSE/Java%E5%9F%BA%E7%A1%80/java8%E6%96%B0%E7%89%B9%E6%80%A7/" title="无题"><img src="/images/home.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/%E9%9D%A2%E8%AF%95%E9%A2%98/JavaSE/Java%E5%9F%BA%E7%A1%80/java8%E6%96%B0%E7%89%B9%E6%80%A7/" title="无题">无题</a><time datetime="2023-10-22T06:41:46.081Z" title="发表于 2023-10-22 14:41:46">2023-10-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95%E9%A2%98/" title="无题"><img src="/images/home.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95/%E7%AE%80%E5%8E%86%E9%9D%A2%E8%AF%95%E9%A2%98/" title="无题">无题</a><time datetime="2023-10-11T11:10:53.711Z" title="发表于 2023-10-11 19:10:53">2023-10-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/%E7%AE%97%E6%B3%95/%E7%AE%97%E6%B3%95/" title="算法题"><img src="/images/home.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="算法题"/></a><div class="content"><a class="title" href="/%E7%AE%97%E6%B3%95/%E7%AE%97%E6%B3%95/" title="算法题">算法题</a><time datetime="2023-08-31T02:47:33.000Z" title="发表于 2023-08-31 10:47:33">2023-08-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/RDB%E5%92%8CAOF/" title="Redis持久化"><img src="/images/home.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Redis持久化"/></a><div class="content"><a class="title" href="/RDB%E5%92%8CAOF/" title="Redis持久化">Redis持久化</a><time datetime="2023-08-26T13:23:19.000Z" title="发表于 2023-08-26 21:23:19">2023-08-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/JUC/" title="JUC学习笔记"><img src="/images/home.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JUC学习笔记"/></a><div class="content"><a class="title" href="/JUC/" title="JUC学习笔记">JUC学习笔记</a><time datetime="2023-08-26T13:23:19.000Z" title="发表于 2023-08-26 21:23:19">2023-08-26</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By huxianseng</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><div class="js-pjax"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex/dist/contrib/copy-tex.min.js"></script><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', { class: 'katex-wrap'})
  })
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="true"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>